<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.garam.web.rsvt.mapper.RsvtMapper">

	<sql id="customerColumns">
		ctmseq , ctmsepa , ctmname , ctmaddress , ctmtel1 , ctmtel2
		, ctmfax , ctmhomepage , ctmstp , ctmdetail ,
		ctmtrash
	</sql>
	<sql id="rsvtColumns">
		rsvtseq, rsvt, ctmseq, datein, datech, empin, stday,
		endday, bus, num, desty, rsvpstp, stt, endt, rsvtdetail, cont, conm,
		confirm,
		confirmm, rsvttrash
	</sql>

	<select id="selectCustomerAll"
		resultType="com.garam.web.rsvt.dto.RsvtDTO">
		SELECT

		<include refid="customerColumns" />

		FROM customer WHERE ctmtrash = 1;
	</select>

	<select id="selectCustomerName"
		parameterType="com.garam.web.rsvt.dto.RsvtDTO"
		resultType="com.garam.web.rsvt.dto.RsvtDTO">
		SELECT

		<include refid="customerColumns" />

		FROM customer

		<where>
			<if test="ctmseq > 0">AND ctmseq = #{ctmseq}
			</if>
			<if test="ctmname != null">AND ctmname = #{ctmname}
			</if>
			<if test="ctmsepa > 0">AND ctmsepa = #{ctmsepa}
			</if>
		</where>
	</select>

	<insert id="insertRsvt"
		parameterType="com.garam.web.rsvt.dto.RsvtDTO">

		<choose>
			<when test='ctmseq > 0'>
				INSERT INTO
				rsvt
				(
				<include refid="rsvtColumns" />
				)
				VALUES
				(
				null
				, #{rsvt}
				, #{ctmseq}
				, now()
				, null
				, #{empin}
				, #{stday}
				,
				#{endday}
				, #{bus}
				, #{num}
				, #{desty}
				, #{rsvpstp}
				,
				#{stt}
				, #{endt}
				,
				#{rsvtdetail}
				,
				#{cont}
				, #{conm}
				, #{confirm}
				, 1
				, 1
				);
			</when>
			<otherwise>
				INSERT INTO
				customer
				(
				<include refid="customerColumns" />
				)
				VALUES
				(
				null
				, #{ctmsepa}
				, #{ctmname}
				, #{ctmaddress}
				, #{ctmtel1}
				,
				#{ctmtel2}
				, #{ctmfax}
				, #{ctmhomepage}
				, #{ctmstp}
				, #{ctmdetail}
				, 1
				);

				INSERT INTO
				rsvt
				(
				<include refid="rsvtColumns" />
				)
				VALUES
				(
				null
				, #{rsvt}
				, (SELECT MAX(ctmseq) FROM customer)
				, now()
				,
				null
				, #{empin}
				, #{stday}
				, #{endday}
				, #{bus}
				, #{num}
				, #{desty}
				,
				#{rsvpstp}
				,
				#{stt}
				, #{endt}
				,
				#{rsvtdetail}
				, #{cont}
				, #{conm}
				,
				#{confirm}
				, 1
				, 1
				);
			</otherwise>
		</choose>
	</insert>

	<select id="selectAlloCTM"
		parameterType="com.garam.web.rsvt.dto.RsvtDTO"
		resultType="com.garam.web.rsvt.dto.RsvtDTO">
		SELECT
		rsvt.rsvt,
		customer.ctmseq, customer.ctmsepa,
		customer.ctmname,
		customer.ctmaddress, customer.ctmtel1,
		customer.ctmtel2,
		customer.ctmfax, customer.ctmhomepage,
		customer.ctmstp,
		customer.ctmdetail,
		customer.ctmtrash

		FROM rsvt

		LEFT JOIN
		customer on
		rsvt.ctmseq = customer.ctmseq

		WHERE

		(rsvt.stday <![CDATA[<=]]>
		#{stday})
		AND
		(rsvt.endday <![CDATA[>=]]>
		#{stday})

		GROUP BY
		customer.ctmseq

		ORDER BY
		customer.ctmsepa,
		customer.ctmseq
	</select>
	<select id="selectAlloRSVT"
		parameterType="com.garam.web.rsvt.dto.RsvtDTO"
		resultType="com.garam.web.rsvt.dto.RsvtDTO">
		SELECT *

		FROM
		rsvt

		left join customer on rsvt.ctmseq =
		customer.ctmseq

		WHERE

		(rsvt.stday <![CDATA[<=]]>
		#{stday})
		AND
		(rsvt.endday <![CDATA[>=]]>
		#{stday})

		ORDER BY
		customer.ctmsepa,
		customer.ctmseq
	</select>
	<select id="selectAlloOPER"
		parameterType="com.garam.web.rsvt.dto.RsvtDTO"
		resultType="com.garam.web.rsvt.dto.RsvtDTO">
		SELECT *

		FROM operation_info

		left join rsvt
		on operation_info.rsvt = rsvt.rsvt

		WHERE

		operation_info.rsvt
		IN
		(SELECT
		rsvt.rsvt

		FROM rsvt

		left join customer
		on rsvt.ctmseq = customer.ctmseq

		WHERE

		(rsvt.stday <![CDATA[<=]]>
		#{stday})
		AND
		(rsvt.endday <![CDATA[>=]]>
		#{stday})

		AND

		operation_info.operday = #{stday}

		ORDER BY
		rsvt.ctmseq);
	</select>
	<!-- <select id="selectAlloOPER" parameterType="hashmap" -->
	<!-- resultType="com.garam.web.rsvt.dto.OperationRsvtDTO"> -->
	<!-- SELECT -->

	<!-- * -->

	<!-- FROM operation_info -->

	<!-- WHERE -->

	<!-- operation_info.rsvt -->

	<!-- IN -->

	<!-- <foreach collection="rsvt" item="rsvt" open="(" close=")" -->
	<!-- separator=","> -->

	<!-- #{rsvt.value} -->

	<!-- </foreach> -->
	<!-- </select> -->
</mapper>